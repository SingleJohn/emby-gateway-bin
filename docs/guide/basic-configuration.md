# 基础配置

这篇是给普通用户的实操文档：按顺序做，不需要理解底层实现。

## 1. 第一步：新增 Source（入口）

在管理后台新增一个 Source，最少填这些：

- 名称（随意但建议易懂）
- 监听端口（例如 `18889`）
- 上游 Emby 地址（Host）

建议：先只建一个 Source，确认能正常播放后再扩展。

## 2. 第二步：新增后端（存储）

按你的实际存储类型新增后端，例如：

- S3
- CDN
- GDrive
- 本地（Local / Local Agent）

每个后端都先做一次连通性确认，再进入下一步。

## 3. 第三步：创建资源池（主备关系）

创建 1 个资源池并设置：

- 主后端（Primary）
- 备后端（Standby，可选但强烈建议）

这样主后端异常时能自动切备，体验更稳。

## 4. 第四步：配置路径映射（可选）

如果你的 Emby 路径和后端路径不一致，需要加路径映射。

常见示例：

- Emby 路径前缀：`/mnt/media`
- 后端实际前缀：`/media`

如果路径一致，可以先不配映射。

## 5. 第五步：配置路由规则

创建一条默认路由（兜底）：

- 绑定到上一步资源池
- 优先级设置成较大的数（例如 100）
- 先保证“所有请求都能命中”

后续再逐步加精细规则（按目录分流）。

## 6. 第六步：播放验证

验证顺序：

1. 客户端能正常发起播放
2. 后台看到请求命中对应规则
3. 可以看到重定向到预期后端
4. 播放连续 5-10 分钟无中断

## 7. 故障排查

如果遇到配置问题，请参考 [排障指南](../ops/troubleshooting.md#85-基本配置故障排查) 中的相关部分。

## 8. 推荐实践

1. 先“单路由跑通”，再做复杂分流
2. 每次只改一处配置，方便回退
3. 规则命名清晰（例如 `movie-default`、`tv-backup`）

## 9. 截图补充位（后续可直接替换）

建议把对应页面截图放到 `docs/assets/images/`，并按如下文件名补充：

- `02-source-config.png`
- `03-backend-config.png`
- `04-resource-pool.png`
- `05-route-rule.png`
