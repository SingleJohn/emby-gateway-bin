# 管理界面使用指南

本文档详细介绍 Emby Gateway 管理界面的使用方法，包括主要功能页面的操作步骤和使用说明。

> 页面截图统一规划见：[系统页面截图规划](/guide/ui-screenshot-plan)

## 1. 登录管理界面

### 访问地址

打开浏览器，输入以下地址访问管理界面：

```
http://<服务器IP>:<管理端口>/ui/#/login?redirect=/overview
```

默认管理端口为 `18888`，例如：

```
http://192.168.1.100:18888/ui/#/login?redirect=/overview
```

如配置了控制台路径前缀，访问地址需要添加前缀，例如：

```
http://43.248.133.206:19999/asdfg/ui/#/login?redirect=/overview
```


### 登录验证

- **首次登录**：默认情况下，首次登录可能不需要密码
- **设置密码后**：输入设置的管理密码登录
- **忘记密码**：如果忘记密码，可能需要重置数据库

## 2. 概览页面 (OverviewPage)

### 功能说明

概览页面是管理界面的首页，提供系统状态的快速查看。

### 主要内容

- **系统状态**：显示网关运行状态、版本信息等
- **请求统计**：展示近期请求量、成功率等统计数据
- **后端状态**：显示各后端的健康状态
- **告警信息**：展示系统告警和异常信息

### 使用方法

1. 登录后自动进入概览页面
2. 查看系统状态和关键指标
3. 点击相应卡片进入详情页面

## 3. Emby Sources 页面 (EmbySourcesPage)

### 功能说明

管理 Emby 源，即网关的入口点，用于接收来自 Emby 客户端的播放请求。

### 操作步骤

#### 添加 Emby Source

1. 点击左侧菜单中的 **Emby Sources**
2. 点击 **添加** 按钮
3. 填写以下信息：
   - **名称**：给 Source 起一个易于识别的名称
   - **监听端口**：设置一个未被占用的端口
   - **上游 Emby 地址**：填写您的 Emby 服务器地址
   - **路径前缀**：可选，设置路径前缀
   - **是否启用**：勾选启用
4. 点击 **保存**

#### 编辑 Emby Source

1. 在 Source 列表中找到要编辑的 Source
2. 点击 **编辑** 按钮
3. 修改相应信息
4. 点击 **保存**

#### 删除 Emby Source

1. 在 Source 列表中找到要删除的 Source
2. 点击 **删除** 按钮
3. 确认删除操作

## 4. 后端管理页面 (BackendsPage)

### 功能说明

管理存储后端，包括 S3、CDN、Google Drive 和本地存储等。

### 操作步骤

#### 添加后端

1. 点击左侧菜单中的 **Backends**
2. 点击 **添加** 按钮
3. 选择后端类型：
   - **S3**：对象存储后端
   - **CDN**：内容分发网络后端
   - **Google Drive**：谷歌云盘后端
   - **Local Agent**：本地存储代理后端
4. 填写相应的配置信息：
   - **S3**：Endpoint、Bucket、Access Key、Secret Key、区域等
   - **CDN**：CDN 基础 URL、路径前缀等
   - **Google Drive**：认证信息、根目录等
   - **Local Agent**：基础目录、API URL、签名密钥等
5. 点击 **保存**

#### 编辑后端

1. 在后端列表中找到要编辑的后端
2. 点击 **编辑** 按钮
3. 修改相应信息
4. 点击 **保存**

#### 删除后端

1. 在后端列表中找到要删除的后端
2. 点击 **删除** 按钮
3. 确认删除操作

#### 测试后端连接

1. 在后端列表中找到要测试的后端
2. 点击 **测试** 按钮
3. 查看测试结果

## 5. 资源池页面

### 功能说明

管理资源池，将后端组合成主备关系，实现故障自动切换。

### 操作步骤

#### 添加资源池

1. 点击左侧菜单中的 **资源池**
2. 点击 **添加** 按钮
3. 填写以下信息：
   - **名称**：资源池名称
   - **描述**：可选，资源池描述
4. 在 **后端** 部分：
   - 点击 **添加后端**
   - 选择后端类型（主后端或备后端）
   - 选择具体后端
   - 设置权重（可选）
5. 点击 **保存**

#### 编辑资源池

1. 在资源池列表中找到要编辑的资源池
2. 点击 **编辑** 按钮
3. 修改相应信息
4. 点击 **保存**

#### 删除资源池

1. 在资源池列表中找到要删除的资源池
2. 点击 **删除** 按钮
3. 确认删除操作

## 6. 路由规则页面

### 功能说明

配置路由规则，决定哪些请求走哪个资源池。

### 操作步骤

#### 添加路由规则

1. 点击左侧菜单中的 **路由规则**
2. 点击 **添加** 按钮
3. 填写以下信息：
   - **名称**：规则名称
   - **路径前缀**：例如 `/movies` 或 `/tv`
   - **资源池**：选择目标资源池
   - **优先级**：设置规则优先级（数字越小优先级越高）
   - **是否启用**：勾选启用
4. 点击 **保存**

#### 编辑路由规则

1. 在路由规则列表中找到要编辑的规则
2. 点击 **编辑** 按钮
3. 修改相应信息
4. 点击 **保存**

#### 删除路由规则

1. 在路由规则列表中找到要删除的规则
2. 点击 **删除** 按钮
3. 确认删除操作

### 路由规则优先级

- 优先级数字越小，规则优先级越高
- 当多个规则匹配时，优先级高的规则生效
- 建议添加一条默认规则（路径前缀为 `/`）作为兜底

## 7. 路径规则集页面 (PathRuleSetsPage)

### 功能说明

管理路径映射规则，解决 Emby 路径与后端存储路径不一致的问题。

### 操作步骤

#### 添加路径映射

1. 点击左侧菜单中的 **路径规则集**
2. 点击 **添加** 按钮
3. 填写以下信息：
   - **名称**：规则集名称
   - **描述**：可选，规则集描述
4. 在 **路径映射** 部分：
   - 点击 **添加映射**
   - 填写 **源路径**（Emby 路径）
   - 填写 **目标路径**（后端存储路径）
5. 点击 **保存**

#### 编辑路径映射

1. 在路径规则集列表中找到要编辑的规则集
2. 点击 **编辑** 按钮
3. 修改相应信息
4. 点击 **保存**

#### 删除路径映射

1. 在路径规则集列表中找到要删除的规则集
2. 点击 **删除** 按钮
3. 确认删除操作

## 8. 缓存管理页面 (CachePage)

### 功能说明

管理网关的缓存设置，优化请求响应速度。

### 主要内容

- **缓存配置**：设置缓存大小、过期时间等
- **缓存状态**：查看当前缓存使用情况
- **缓存操作**：清理缓存、预热缓存等

### 操作步骤

1. 点击左侧菜单中的 **缓存**
2. 修改缓存配置参数
3. 点击 **保存** 应用配置
4. 点击 **清理缓存** 手动清理缓存

## 9. 安全设置页面 (SecurityPage)

### 功能说明

管理系统安全设置，包括访问控制、速率限制等。

### 主要内容

- **管理密码**：设置和修改管理密码
- **访问控制**：配置允许访问的 IP 地址
- **速率限制**：设置请求速率限制
- **安全规则**：配置安全告警规则

### 操作步骤

1. 点击左侧菜单中的 **安全**
2. 修改相应安全设置
3. 点击 **保存** 应用配置

## 10. 安全告警页面 (SecurityAlertsPage)

### 功能说明

配置安全告警规则，按周期统计异常访问并发送通知。

### 主要内容

- **全局设置**：启用开关、执行周期、通知总开关
- **规则管理**：新增/编辑/删除告警规则
- **规则参数**：类型、统计维度、统计窗口、冷却时间、阈值
- **通知绑定**：为每条规则选择一个或多个通知渠道 ID

### 操作步骤

1. 点击左侧菜单中的 **安全告警**
2. 在「全局设置」中配置启用状态和执行周期
3. 在「告警规则」中新增或修改规则并绑定通知渠道
4. 点击页面底部 **保存** 应用配置

## 11. 通知管理页面 (NotifyPage)

### 功能说明

配置通知渠道，并用于安全告警推送与手动测试。

### 操作步骤

#### 添加通知渠道

1. 点击左侧菜单中的 **通知中心**
2. 点击 **添加** 按钮
3. 选择通知类型：
   - **Bark**：iOS 推送通知
   - **Telegram**：Telegram 消息通知
   - **ServerChan**：ServerChan 通知
   - **钉钉**：钉钉机器人通知
   - **企业微信 Webhook**：企业微信群机器人通知
4. 填写相应的配置信息
5. 点击 **保存**

#### 测试通知

1. 在页面顶部选择一个启用通道，点击 **发送测试**；或在通道卡片点击 **测试此通道**
2. 查看通知是否发送成功

## 12. 可观测性页面 (ObservabilityPage)

### 功能说明

查看系统日志、监控指标和请求记录。

### 主要内容

- **系统日志**：查看系统运行日志
- **请求日志**：查看详细的请求记录
- **监控指标**：查看系统监控指标
- **统计报表**：查看请求统计和分析报表

### 操作步骤

1. 点击左侧菜单中的 **可观测性**
2. 选择相应的标签页查看：
   - **日志**：查看系统日志和请求日志
   - **监控**：查看系统监控指标
   - **报表**：查看统计报表
3. 使用过滤条件筛选日志和数据
4. 点击 **导出** 按钮导出数据

## 13. 许可证管理页面 (LicensePage)

### 功能说明

管理系统许可证，查看许可证状态和更新许可证。

### 主要内容

- **许可证状态**：显示当前许可证状态、有效期等
- **许可证信息**：查看许可证详情
- **更新许可证**：上传新的许可证

### 操作步骤

1. 点击左侧菜单中的 **许可证**
2. 查看当前许可证状态
3. 点击 **更新许可证** 上传新的许可证
4. 点击 **刷新** 按钮刷新许可证状态

## 14. Strm 管理页面 (StrmPage)

### 功能说明

管理 Strm 文件，用于 Emby 媒体库的索引和播放。

### 操作步骤

1. 点击左侧菜单中的 **Strm**
2. 配置 Strm 生成规则
3. 点击 **生成** 按钮生成 Strm 文件
4. 查看生成结果和日志

## 15. S3 浏览器页面 (S3BrowserPage)

### 功能说明

浏览和管理 S3 存储桶中的文件。

### 操作步骤

1. 点击左侧菜单中的 **S3 浏览器**
2. 选择 S3 后端
3. 浏览存储桶中的文件和目录
4. 点击文件查看详情或下载文件

## 16. 网关设置页面 (ConfigPage)

### 功能说明

管理端与观测相关的全局配置，包括管理界面设置、观测性配置、IP 归属地查询和 GDrive Worker 配置。

### 主要内容

- **全局设置**：管理界面地址、端口、密码，以及观测性相关配置
- **IP 归属地查询**：配置 IP 归属地查询方式和缓存设置
- **GDrive Worker**：配置 Google Drive Worker 代理相关设置

### 操作步骤

1. 点击左侧菜单中的 **网关设置**
2. 修改相应配置参数
3. 系统会自动保存配置（2秒延迟），也可点击 **立即保存** 手动保存
4. 点击 **撤销修改** 恢复到之前的配置

### 配置项详情

#### 全局设置

- **Admin Host**：管理界面监听地址，默认为 0.0.0.0
- **Admin Port**：管理界面监听端口，默认为 18888
- **Admin Password**：管理界面密码（留空禁用鉴权）
- **控制台路径前缀**：管理界面路径前缀，留空不启用
- **请求日志保留天数**：请求日志的保留天数
- **统计保留天数**：统计数据的保留天数
- **DB 批量写入条数**：数据库批量写入的条数
- **DB 刷新间隔(ms)**：数据库刷新间隔，单位为毫秒
- **用户识别调试日志**：是否启用用户识别调试日志
- **用户识别 IP 回退**：是否启用用户识别 IP 回退

#### IP 归属地查询

- **IP 查询使用付费接口**：是否使用付费的 IP 归属地查询接口
- **付费接口 Token**：付费接口的认证令牌
- **缓存有效期(天)**：IP 归属地查询结果的缓存有效期
- **清空查询缓存**：手动清空 IP 查询缓存

#### GDrive Worker

- **Worker Base URL**：GDrive Worker 的基础 URL
- **签名密钥 (Sign Key)**：用于 token 签名/验签的密钥
- **同步令牌 (Sync Token)**：Worker 拉取配置的 Bearer Token

### 注意事项

- 配置修改后会自动保存并生效，无需重启服务
- 如修改管理界面端口，需要重新访问新端口
- GDrive Worker 配置需要与 Worker 侧配置保持一致

## 17. 使用指南页面 (UsageGuidePage)

### 功能说明

提供系统使用指南和帮助文档。

### 主要内容

- **快速开始**：快速上手指南
- **配置说明**：详细配置说明
- **故障排查**：常见问题和解决方案
- **最佳实践**：系统使用最佳实践

### 使用方法

1. 点击左侧菜单中的 **使用指南**
2. 浏览相应的帮助文档
3. 点击链接查看详细内容

## 18. 导航与操作技巧

### 快捷键

- **Ctrl + S**：保存当前配置
- **Ctrl + F**：在当前页面搜索
- **Alt + 左侧箭头**：返回上一页

### 操作技巧

1. **批量操作**：在列表页面，选择多个项目进行批量操作
2. **过滤搜索**：使用页面顶部的搜索框过滤内容
3. **排序**：点击列表表头进行排序
4. **分页**：使用分页控件浏览多页内容
5. **导出数据**：在相应页面导出配置和数据

### 常见操作流程

#### 配置新后端并使用

1. 在 **Backends** 页面添加后端
2. 在 **资源池** 页面创建资源池并添加后端
3. 在 **路由规则** 页面添加路由规则，关联资源池
4. 测试播放请求，验证配置是否生效

#### 排查播放失败问题

1. 在 **可观测性** 页面查看请求日志
2. 检查路由规则是否匹配
3. 检查后端连接是否正常
4. 检查路径映射是否正确
5. 根据错误信息进行相应调整

## 19. 界面定制

### 主题设置

1. 点击页面右上角的 **主题** 按钮
2. 选择喜欢的主题（亮色/暗色）
3. 点击 **保存** 应用主题

### 语言设置

1. 点击页面右上角的 **设置** 按钮
2. 选择 **语言** 选项
3. 选择 preferred 语言
4. 点击 **保存** 应用语言设置

## 20. 常见问题与解决方案

### 问题 1：管理页面无法访问

**原因**：
- 服务未运行
- 端口未开放
- 网络连接问题

**解决方案**：
- 检查服务是否运行
- 检查端口是否开放
- 检查网络连接

### 问题 2：页面加载缓慢

**原因**：
- 服务器资源不足
- 数据库性能问题
- 网络延迟

**解决方案**：
- 增加服务器资源
- 优化数据库配置
- 检查网络连接

### 问题 3：配置保存失败

**原因**：
- 数据库连接问题
- 配置参数错误
- 权限问题

**解决方案**：
- 检查数据库连接
- 检查配置参数
- 检查文件权限

### 问题 4：功能页面缺失

**原因**：
- 许可证限制
- 版本差异
- 配置问题

**解决方案**：
- 检查许可证状态
- 升级到最新版本
- 检查系统配置

## 21. 总结

Emby Gateway 管理界面提供了丰富的功能和直观的操作方式，通过本文档的指南，您应该能够熟练使用管理界面的各项功能，配置和管理您的 Emby Gateway 系统。

如果您在使用过程中遇到问题，请参考本文档的常见问题与解决方案，或查看系统日志获取更多信息。
