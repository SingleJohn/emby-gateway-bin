<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1500 920" width="1500" height="920">
  <defs>
    <style>
      .title { font: 700 30px "PingFang SC","Microsoft YaHei",sans-serif; fill: #0f172a; }
      .actor { font: 600 16px "PingFang SC","Microsoft YaHei",sans-serif; fill: #0f172a; }
      .note  { font: 500 14px "PingFang SC","Microsoft YaHei",sans-serif; fill: #334155; }
      .lifeline { stroke: #64748b; stroke-width: 2; stroke-dasharray: 8 8; }
      .msg { stroke: #0f172a; stroke-width: 2.2; fill: none; marker-end: url(#arrow); }
      .ret { stroke: #334155; stroke-width: 2; fill: none; stroke-dasharray: 6 6; marker-end: url(#arrow2); }
      .box { stroke: #334155; stroke-width: 2; rx: 10; ry: 10; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#0f172a"/>
    </marker>
    <marker id="arrow2" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#334155"/>
    </marker>
  </defs>

  <rect x="0" y="0" width="1500" height="920" fill="#f8fafc"/>
  <text x="48" y="56" class="title">播放请求时序图（含主备切换）</text>

  <rect x="70" y="90" width="190" height="62" fill="#dbeafe" class="box"/>
  <text x="132" y="128" class="actor">Emby 客户端</text>
  <line x1="165" y1="152" x2="165" y2="860" class="lifeline"/>

  <rect x="320" y="90" width="190" height="62" fill="#bfdbfe" class="box"/>
  <text x="382" y="128" class="actor">Source 入口</text>
  <line x1="415" y1="152" x2="415" y2="860" class="lifeline"/>

  <rect x="570" y="90" width="190" height="62" fill="#c7d2fe" class="box"/>
  <text x="630" y="128" class="actor">路由/映射</text>
  <line x1="665" y1="152" x2="665" y2="860" class="lifeline"/>

  <rect x="820" y="90" width="190" height="62" fill="#ddd6fe" class="box"/>
  <text x="882" y="128" class="actor">资源池</text>
  <line x1="915" y1="152" x2="915" y2="860" class="lifeline"/>

  <rect x="1070" y="90" width="190" height="62" fill="#fecdd3" class="box"/>
  <text x="1132" y="128" class="actor">主后端</text>
  <line x1="1165" y1="152" x2="1165" y2="860" class="lifeline"/>

  <rect x="1320" y="90" width="140" height="62" fill="#bbf7d0" class="box"/>
  <text x="1352" y="128" class="actor">存储服务</text>
  <line x1="1390" y1="152" x2="1390" y2="860" class="lifeline"/>

  <path d="M165 210 L415 210" class="msg"/>
  <text x="224" y="200" class="note">1) 播放请求</text>

  <path d="M415 270 L665 270" class="msg"/>
  <text x="468" y="260" class="note">2) 匹配路由规则</text>

  <path d="M665 330 L915 330" class="msg"/>
  <text x="720" y="320" class="note">3) 应用路径映射</text>

  <path d="M915 390 L1165 390" class="msg"/>
  <text x="966" y="380" class="note">4) 选择主后端并请求</text>

  <path d="M1165 450 L1390 450" class="msg"/>
  <text x="1212" y="440" class="note">5) 获取临时直链</text>

  <path d="M1390 500 L1165 500" class="ret"/>
  <text x="1210" y="490" class="note">6) 返回地址（成功）</text>

  <path d="M1165 560 L915 560" class="ret"/>
  <text x="966" y="550" class="note">7) 返回可访问地址</text>

  <path d="M915 620 L415 620" class="ret"/>
  <text x="624" y="610" class="note">8) Source 组装重定向响应</text>

  <path d="M415 680 L165 680" class="ret"/>
  <text x="244" y="670" class="note">9) 返回 302 / 直链</text>

  <path d="M165 740 L1390 740" class="msg"/>
  <text x="712" y="730" class="note">10) 客户端直连存储拉流</text>

  <rect x="855" y="790" width="580" height="80" fill="#fff7ed" class="box"/>
  <text x="878" y="824" class="note">失败分支：若主后端不可用，资源池切换备后端并重试，再返回可用地址。</text>
  <text x="878" y="850" class="note">告警分支：命中安全规则时，安全告警任务会按配置通知渠道发送告警。</text>
</svg>
